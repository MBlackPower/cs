/* cxlockld.c  --xlockld C version *
 * This program can backup the partition in an file and at No.3 No.7 sector;*
 * You can restore the partition table */
/* book: harddisk protection technique handbook *
 * page:66  creat on 2/13/1999  use tc20        *
 * modify on 2/13/1999                          */
#include <stdio.h>
#include <dos.h>
#include <fcntl.h>
#include <sys\stat.h>
char sector1[512]={0xFA,0x33,0xC0,0x8E,0xD0,0xBC,0x00,0x7C,0x8B,0xF4,0x50,0x07,
	0x50,0x1F,0xFB,0xFC,0xBF,0x00,0x06,0xB9,0x00,0x01,0xF2,0xA5,
	0xEA,0x1D,0x06,0x00,0x00,0xBE,0xE8,0x06,0xE8,0xF5,0x00,0xB4,
	0x00,0xCD,0x16,0x80,0xFC,0x52,0x74,0x08,0xBE,0x05,0x07,0xE8,
	0xE6,0x00,0xEB,0xFE,0xBE,0xBE,0x07,0xB3,0x04,0x80,0x3C,0x80,
	0x74,0x0E,0x80,0x3C,0x00,0x75,0x1C,0x83,0xC6,0x10,0xFE,0xCB,
	0x75,0xEF,0xCD,0x18,0x8B,0x14,0x8B,0x4C,0x02,0x8B,0xEE,0x83,
	0xC6,0x10,0xFE,0xCB,0x74,0x0D,0x80,0x3C,0x00,0x74,0xF4,0xBE,
	0x95,0x06,0xE8,0xB3,0x00,0xEB,0xFE,0xBF,0x05,0x00,0xBB,0x00,
	0x7C,0xB8,0x01,0x02,0x57,0xCD,0x13,0x5F,0x73,0x0C,0x33,0xC0,
	0xCD,0x13,0x4F,0x75,0xED,0xBE,0xAE,0x06,0xEB,0xE0,0xBE,0xCE,
	0x06,0xBF,0xFE,0x7D,0x81,0x3D,0x55,0xAA,0x75,0xD4,0x8B,0xF5,
	0xEA,0x00,0x7C,0x00,0x00,0x49,0x6E,0x76,0x61,0x6C,0x69,0x64,
	0x20,0x70,0x61,0x72,0x74,0x69,0x74,0x69,0x6F,0x6E,0x20,0x74,
	0x61,0x62,0x6C,0x65,0x21,0x00,0x45,0x72,0x72,0x6F,0x72,0x20,
	0x6C,0x6F,0x61,0x64,0x69,0x6E,0x67,0x20,0x6F,0x70,0x65,0x72,
	0x61,0x74,0x69,0x6E,0x67,0x20,0x73,0x79,0x73,0x74,0x65,0x6D,
	0x21,0x00,0x4D,0x69,0x73,0x73,0x69,0x6E,0x67,0x20,0x6F,0x70,
	0x65,0x72,0x61,0x74,0x69,0x6E,0x67,0x20,0x73,0x79,0x73,0x74,
	0x65,0x6D,0x21,0x00,0x50,0x72,0x65,0x73,0x73,0x20,0x70,0x61,
	0x73,0x73,0x6B,0x65,0x79,0x20,0x74,0x6F,0x20,0x63,0x6F,0x6E,
	0x74,0x69,0x6E,0x75,0x65,0x3A,0x0A,0x0D,0x00,0x55,0x6E,0x61,
	0x75,0x74,0x68,0x6F,0x72,0x69,0x7A,0x65,0x64,0x20,0x55,0x73,
	0x65,0x72,0x21,0x00,0xAC,0x3C,0x00,0x74,0x0B,0x56,0xBB,0x07,
	0x00,0xB4,0x0E,0xCD,0x10,0x5E,0xEB,0xF0,0xC3,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x80,0x01,0x01,0x00,0x0B,0xFE,0x3F,0x79,0x3F,0x00,
	0x00,0x00,0xBB,0xE7,0x1D,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x01,0xE7,0x0F,0xFE,0xBF,0x0B,0x27,0xA0,
	0x38,0x00,0xA6,0x11,0x48,0x00,0x55,0xAA};
char buffer[512];
void title()
{
 puts("\n __________________________________________");
 puts("|     *** C-Xlock install program ***      |");
 puts("|------------------------------------------|");
 puts("|    -- By Stephen Howard   on 02/13/1999  |");
 puts("|__________________________________________|");
}
void copypart(char *src,char *dest)
{
 char plength;
 plength=0x40;
 while(plength>=0)
   {
    *(dest+plength)=*(src+plength);
    plength--;
   }
}
main()
{
 char filename[20];
 int  fp;
 title();
 printf("\nBackup filename:");
 scanf("%s",filename);
 fp=open(filename,O_CREAT|O_BINARY,S_IREAD|S_IWRITE);
 if(fp==-1)
   {puts("\n File open error!");
    exit(0);
   }
 while((biosdisk(0x20,0x80,0,0,1,1,buffer))!=0);
   copypart(buffer+0x1be,sector1+0x1be);
 while((biosdisk(0x03,0x80,0,0,3,1,buffer))!=0);
 while((biosdisk(0x03,0x80,0,0,7,1,buffer))!=0);
 while((biosdisk(0x03,0x80,0,0,1,1,sector1))!=0);
 write(fp,buffer,512);
 close(fp);
 puts("\nInstall OK!");
}







